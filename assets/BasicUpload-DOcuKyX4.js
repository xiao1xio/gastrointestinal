var C=Object.defineProperty,w=Object.defineProperties;var S=Object.getOwnPropertyDescriptors;var d=Object.getOwnPropertySymbols;var B=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var u=(e,t,o)=>t in e?C(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,n=(e,t)=>{for(var o in t||(t={}))B.call(t,o)&&u(e,o,t[o]);if(d)for(var o of d(t))V.call(t,o)&&u(e,o,t[o]);return e},l=(e,t)=>w(e,S(t));import{dJ as __unplugin_components_5,d as defineComponent,H as computed,u as useMessage,G as useDialog,a as reactive,al as watch,an as toRefs,aY as useGlobSetting,af as isString,R as ResultEnum,s as _export_sfc,aq as resolveComponent,o as openBlock,y as createElementBlock,h as createBaseVNode,a5 as Fragment,a6 as renderList,as as normalizeStyle,g as createVNode,w as withCtx,bw as mergeProps,v as createCommentVNode,f as createBlock,j as createTextVNode,a7 as toDisplayString,N as NIcon,aG as __unplugin_components_9,S as __unplugin_components_4,a3 as __unplugin_components_5$1}from"./index-DxMZejvi.js";import{c as componentSetting}from"./componentSetting-CQq0JJwW.js";import{E as EyeOutlined}from"./EyeOutlined-CpPAOxYv.js";import{D as DeleteOutlined}from"./DeleteOutlined-BN7K7XMB.js";import{P as PlusOutlined}from"./PlusOutlined-DH-IsLQU.js";const basicProps=l(n({},__unplugin_components_5.props),{accept:{type:String,default:".jpg,.png,.jpeg,.svg,.gif"},helpText:{type:String,default:""},maxSize:{type:Number,default:2},maxNumber:{type:Number,default:1/0},value:{type:Array,default:()=>[]},width:{type:Number,default:104},height:{type:Number,default:104}}),globSetting=useGlobSetting(),_sfc_main=defineComponent({name:"BasicUpload",components:{EyeOutlined,DeleteOutlined,PlusOutlined},props:n({},basicProps),emits:["uploadChange","delete"],setup(props,{emit}){const getCSSProperties=computed(()=>({width:`${props.width}px`,height:`${props.height}px`})),message=useMessage(),dialog=useDialog(),state=reactive({showModal:!1,previewUrl:"",originalImgList:[],imgList:[]});watch(()=>props.value,()=>{state.imgList=props.value.map(e=>getImgUrl(e))},{immediate:!0});function preview(e){state.showModal=!0,state.previewUrl=e}function remove(e){dialog.info({title:"提示",content:"你确定要删除吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{state.imgList.splice(e,1),state.originalImgList.splice(e,1),emit("uploadChange",state.originalImgList),emit("delete",state.originalImgList)},onNegativeClick:()=>{}})}function getImgUrl(e){const{imgUrl:t}=globSetting;return/(^http|https:\/\/)/g.test(e)?e:`${t}${e}`}function checkFileType(e){return componentSetting.upload.fileType.includes(e)}function beforeUpload({file:e}){const t=e.file,{maxSize:o,accept:i}=props,r=isString(i)&&i.split(",")||[];if(o&&t.size/1024/1024>=o)return message.error(`上传文件最大值不能超过${o}M`),!1;const c=componentSetting.upload.fileType;return r.length>0&&!checkFileType(t.type)?(message.error(`只能上传文件类型为${c.join(",")}`),!1):!0}function finish({event:Event}){const res=eval("("+Event.target.response+")"),infoField=componentSetting.upload.apiSetting.infoField,{code}=res,message=res.msg||res.message||"上传失败",result=res[infoField];if(code===ResultEnum.SUCCESS){let e=getImgUrl(result.photo);state.imgList.push(e),state.originalImgList.push(result.photo),emit("uploadChange",state.originalImgList)}else message.error(message)}return l(n({},toRefs(state)),{finish,preview,remove,beforeUpload,getCSSProperties})}}),_hoisted_1={class:"w-full"},_hoisted_2={class:"upload"},_hoisted_3={class:"upload-card"},_hoisted_4={class:"upload-card-item-info"},_hoisted_5={class:"img-box"},_hoisted_6=["src"],_hoisted_7={class:"img-box-actions"},_hoisted_8={class:"flex flex-col justify-center"},_hoisted_9=["src"];function _sfc_render(e,t,o,i,r,c){const m=resolveComponent("EyeOutlined"),a=NIcon,g=resolveComponent("DeleteOutlined"),_=resolveComponent("PlusOutlined"),f=__unplugin_components_5,h=__unplugin_components_9,v=__unplugin_components_4,N=__unplugin_components_5$1;return openBlock(),createElementBlock(Fragment,null,[createBaseVNode("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[createBaseVNode("div",_hoisted_3,[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.imgList,(s,p)=>(openBlock(),createElementBlock("div",{class:"upload-card-item",style:normalizeStyle(e.getCSSProperties),key:`img_${p}`},[createBaseVNode("div",_hoisted_4,[createBaseVNode("div",_hoisted_5,[createBaseVNode("img",{src:s},null,8,_hoisted_6)]),createBaseVNode("div",_hoisted_7,[createVNode(a,{size:"18",class:"mx-2 action-icon",onClick:y=>e.preview(s)},{default:withCtx(()=>[createVNode(m)]),_:2},1032,["onClick"]),createVNode(a,{size:"18",class:"mx-2 action-icon",onClick:y=>e.remove(p)},{default:withCtx(()=>[createVNode(g)]),_:2},1032,["onClick"])])])],4))),128)),e.imgList.length<e.maxNumber?(openBlock(),createElementBlock("div",{key:0,class:"upload-card-item upload-card-item-select-picture",style:normalizeStyle(e.getCSSProperties)},[createVNode(f,mergeProps({class:"w-auto"},e.$props,{"file-list-style":{display:"none"},onBeforeUpload:e.beforeUpload,onFinish:e.finish}),{default:withCtx(()=>[createBaseVNode("div",_hoisted_8,[createVNode(a,{size:"18",class:"m-auto"},{default:withCtx(()=>[createVNode(_)]),_:1}),t[1]||(t[1]=createBaseVNode("span",{class:"upload-title"},"上传图片",-1))])]),_:1},16,["onBeforeUpload","onFinish"])],4)):createCommentVNode("",!0)])]),createVNode(v,null,{default:withCtx(()=>[e.helpText?(openBlock(),createBlock(h,{key:0,title:"提示",type:"info",class:"flex w-full"},{default:withCtx(()=>[createTextVNode(toDisplayString(e.helpText),1)]),_:1})):createCommentVNode("",!0)]),_:1})]),createVNode(N,{show:e.showModal,"onUpdate:show":t[0]||(t[0]=s=>e.showModal=s),preset:"card",title:"预览",bordered:!1,style:{width:"520px"}},{default:withCtx(()=>[createBaseVNode("img",{src:e.previewUrl},null,8,_hoisted_9)]),_:1},8,["show"])],64)}const BasicUpload=_export_sfc(_sfc_main,[["render",_sfc_render]]);export{BasicUpload as B};
